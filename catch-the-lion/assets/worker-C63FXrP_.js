(function(){"use strict";const g=(e,s)=>{let t=0;const n=e.length;for(let o=0;o<n;o++)s(e[o])&&t++;return t};function C(e,s){const t=[],n=[],o=e.length;for(let i=0;i<o;i++){const r=e[i];s(r)?t.push(r):n.push(r)}return[t,n]}const a={C:[[0,1]],H:[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,1]],G:[[0,1],[1,0],[0,-1],[-1,0]],E:[[1,1],[-1,1],[1,-1],[-1,-1]],L:[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,1],[1,-1],[-1,-1]]},M=(e,s)=>e.owner===s.owner&&e.position===s.position&&e.type===s.type,P=(e,s)=>{for(let t=0;t<8;t++)if(!M(e[t],s[t]))return!1;return!0},E={L:1e3,H:70,G:50,E:30,C:10},m=(e,s)=>{const t=[],n=new Array(12);n.fill(0);for(const o of e)o.position!==null&&(n[o.position]=o.owner+1);for(let o=0;o<8;o++){const i=e[o];if(i.owner===s)if(i.position===null){if(o<4||e[o-4].owner!==i.owner||e[o-4].position!==null)for(let r=0;r<12;r++)n[r]||t.push([o,r])}else{const r=i.position%3,u=i.position/3|0,p=a[i.type];for(const f of p){const[l,y]=s?[f[0],f[1]]:[-f[0],-f[1]],c=r+l,v=u+y;if(c>=0&&c<3&&v>=0&&v<4){const x=3*v+c;n[x]!==i.owner+1&&t.push([o,x])}}}}return t},d=(e,[s,t])=>{const{owner:n,type:o,position:i}=e[s],r=e.map(p=>({...p})),u=e.findIndex(p=>p.position===t);return u>=0&&(r[u].position=null,r[u].owner=n,r[u].type==="H"&&(r[u].type="C")),r[s].position=t,o==="C"&&i!==null&&(n&&t>8||!n&&t<3)&&(r[s].type="H"),r},H=e=>{let s=0;const t=new Array(12);t.fill(0);for(const n of e)s+=(n.owner?-1:1)*E[n.type],n.position!==null&&(t[n.position]=n.owner+1);for(let n=0;n<8;n++){const o=e[n];if(o.position!==null){const i=o.position%3,r=o.position/3|0,u=a[o.type];for(const p of u){const[f,l]=o.owner===1?[p[0],p[1]]:[-p[0],-p[1]],y=i+f,c=r+l;if(y>=0&&y<3&&c>=0&&c<4){const v=3*c+y;t[v]!==o.owner+1&&(s+=o.owner?-1:1)}}}}return s},w=(e,s,t,n,o)=>{const i=m(o,s);if(e===0)return H(o);if(o[1].position===null)return-1e5-e;if(o[5].position===null)return 1e5+e;if(s&&o[5].position>8)return-1e5-e;if(!s&&o[1].position<3)return 1e5+e;{const r=i.length;for(let u=0;u<r;u++){const p=i[u],f=d(o,p);if(s===0){const l=w(e-1,1,t,n,f);l>t&&(t=l)}else{const l=w(e-1,0,t,n,f);l<n&&(n=l)}if(t>=n)break}return s===0?t:n}},I=(e,s,t,n)=>{let o=-1/0,i=1/0;const r=m(n,t).map(l=>[l,d(n,l)]),[u,p]=C(r,([l,y])=>g(e,c=>P(c,y))>=1);let f=null;for(const[l,y]of p)if(t===0){const c=w(s-1,1,o,i,y);c>o&&(o=c,f=l)}else{const c=w(s-1,0,o,i,y);c<i&&(i=c,f=l)}if(f)return f;for(const[l,y]of u)if(t===0){const c=w(s-1,1,o,i,y);c>o&&(o=c,f=l)}else{const c=w(s-1,0,o,i,y);c<i&&(i=c,f=l)}return f};onmessage=e=>{const{pieces:s,turn:t,adversary:n,played:o}=e.data;postMessage(I(o,n==="level1"?2:n==="level2"?5:n==="level3"?8:2,t,s))}})();
