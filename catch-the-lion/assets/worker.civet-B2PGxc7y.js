(function(){"use strict";const x={C:[[0,1]],H:[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,1]],G:[[0,1],[1,0],[0,-1],[-1,0]],E:[[1,1],[-1,1],[1,-1],[-1,-1]],L:[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,1],[1,-1],[-1,-1]]},m={L:1e3,H:7,G:5,E:3,C:1};function C(t,r){const i=[],n=new Array(12);n.fill(0);for(const o of t)o.position!==null&&(n[o.position]=o.owner+1);for(let o=0;o<8;o++){const l=t[o];if(l.owner===r)if(l.position===null){if(o<4||t[o-4].owner!==l.owner||t[o-4].position!==null)for(let e=0;e<12;e++)n[e]||i.push([o,e])}else{const e=l.position%3,s=l.position/3|0,f=x[l.type];for(const c of f){const[p,y]=r?[c[0],c[1]]:[-c[0],-c[1]],u=e+p,v=s+y;if(u>=0&&u<3&&v>=0&&v<4){const d=3*v+u;n[d]!==l.owner+1&&i.push([o,d])}}}}return i}function a(t,[r,i]){const{owner:n,type:o,position:l}=t[r],e=t.map(f=>({...f})),s=t.findIndex(f=>f.position===i);return s>=0&&(e[s].position=null,e[s].owner=n,e[s].type==="H"&&(e[s].type="C")),e[r].position=i,o==="C"&&l!==null&&(n&&i>8||!n&&i<3)&&(e[r].type="H"),e}function H(t){let r=0;const i=new Array(12);i.fill(0);for(const n of t)r+=(n.owner?-1:1)*m[n.type],n.position!==null&&(i[n.position]=n.owner+1);for(let n=0;n<8;n++){const o=t[n];if(o.position!==null){const l=o.position%3,e=o.position/3|0,s=x[o.type];for(const f of s){const[c,p]=o.owner===1?[f[0],f[1]]:[-f[0],-f[1]],y=l+c,u=e+p;if(y>=0&&y<3&&u>=0&&u<4){const v=3*u+y;i[v]!==o.owner+1&&(r+=.1*(o.owner?-1:1))}}}}return r}function w(t,r,i,n,o){const l=C(o,r);let e,s;if(t===0)return e=H(o),[e,s];if(o[1].position===null)return[-1e5-t,s];if(o[5].position===null)return[1e5+t,s];if(r&&o[5].position>8)return[-1e5-t,s];if(r&&o[1].position<3)return[1e5+t,s];for(let f=0;f<l.length;f++){const c=l[f],p=a(o,c);if(r===0?(e=w(t-1,1,i,n,p)[0],e>i&&(i=e,s=c)):(e=w(t-1,0,i,n,p)[0],e<n&&(n=e,s=c)),i>=n)break}return r===0?[i,s]:[n,s]}onmessage=t=>{const{pieces:r,turn:i,adversary:n}=t.data;let o,l;o=n,o==="level1"?l=2:o==="level2"?l=4:o==="level3"?l=9:l=2;const s=w(l,i,-1/0,1/0,r);return postMessage(s[1])}})();
