(function(){"use strict";function g(e,s){let n=0;const t=e.length;for(let o=0;o<t;o++)s(e[o])&&n++;return n}function C(e,s){const n=[],t=[],o=e.length;for(let i=0;i<o;i++){const r=e[i];s(r)?n.push(r):t.push(r)}return[n,t]}const a={C:[[0,1]],H:[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,1]],G:[[0,1],[1,0],[0,-1],[-1,0]],E:[[1,1],[-1,1],[1,-1],[-1,-1]],L:[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,1],[1,-1],[-1,-1]]},M=(e,s)=>e.owner===s.owner&&e.position===s.position&&e.type===s.type,P=(e,s)=>{for(let n=0;n<8;n++)if(!M(e[n],s[n]))return!1;return!0},E={L:1e3,H:70,G:50,E:30,C:10};function m(e,s){const n=[],t=new Array(12);t.fill(0);for(const o of e)o.position!==null&&(t[o.position]=o.owner+1);for(let o=0;o<8;o++){const i=e[o];if(i.owner===s)if(i.position===null){if(o<4||e[o-4].owner!==i.owner||e[o-4].position!==null)for(let r=0;r<12;r++)t[r]||n.push([o,r])}else{const r=i.position%3,u=i.position/3|0,p=a[i.type];for(const c of p){const[l,y]=s?[c[0],c[1]]:[-c[0],-c[1]],f=r+l,v=u+y;if(f>=0&&f<3&&v>=0&&v<4){const x=3*v+f;t[x]!==i.owner+1&&n.push([o,x])}}}}return n}function d(e,[s,n]){const{owner:t,type:o,position:i}=e[s],r=e.map(p=>({...p})),u=e.findIndex(p=>p.position===n);return u>=0&&(r[u].position=null,r[u].owner=t,r[u].type==="H"&&(r[u].type="C")),r[s].position=n,o==="C"&&i!==null&&(t&&n>8||!t&&n<3)&&(r[s].type="H"),r}function H(e){let s=0;const n=new Array(12);n.fill(0);for(const t of e)s+=(t.owner?-1:1)*E[t.type],t.position!==null&&(n[t.position]=t.owner+1);for(let t=0;t<8;t++){const o=e[t];if(o.position!==null){const i=o.position%3,r=o.position/3|0,u=a[o.type];for(const p of u){const[c,l]=o.owner===1?[p[0],p[1]]:[-p[0],-p[1]],y=i+c,f=r+l;if(y>=0&&y<3&&f>=0&&f<4){const v=3*f+y;n[v]!==o.owner+1&&(s+=o.owner?-1:1)}}}}return s}function w(e,s,n,t,o){const i=m(o,s);if(e===0)return H(o);if(o[1].position===null)return-1e5-e;if(o[5].position===null)return 1e5+e;if(s&&o[5].position>8)return-1e5-e;if(!s&&o[1].position<3)return 1e5+e;{const r=i.length;for(let u=0;u<r;u++){const p=i[u],c=d(o,p);if(s===0){const l=w(e-1,1,n,t,c);l>n&&(n=l)}else{const l=w(e-1,0,n,t,c);l<t&&(t=l)}if(n>=t)break}return s===0?n:t}}function I(e,s,n,t){let o=-1/0,i=1/0;const r=m(t,n).map(l=>[l,d(t,l)]),[u,p]=C(r,([l,y])=>g(e,f=>P(f,y))>=1);let c=null;for(const[l,y]of p)if(n===0){const f=w(s-1,1,o,i,y);f>o&&(o=f,c=l)}else{const f=w(s-1,0,o,i,y);f<i&&(i=f,c=l)}if(c)return c;for(const[l,y]of u)if(n===0){const f=w(s-1,1,o,i,y);f>o&&(o=f,c=l)}else{const f=w(s-1,0,o,i,y);f<i&&(i=f,c=l)}return c}onmessage=e=>{const{pieces:s,turn:n,adversary:t,played:o}=e.data;let i,r;return i=t,i==="level1"?r=2:i==="level2"?r=4:i==="level3"?r=8:r=2,postMessage(I(o,r,n,s))}})();
